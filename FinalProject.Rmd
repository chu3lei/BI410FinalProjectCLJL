---
title: "BI410 Final Project"
author: "Chu Lei & Jennifer Linnaea"
date: "2025-19-11"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


```{r load-libraries-lab, echo=FALSE, results="hide", message=FALSE, warning=FALSE}
#Loading the libraries needed for the project.
library(tidyr)
library(terra)
library(ggplot2)
library(dplyr)
library(sf)
library(ggspatial)
library(RColorBrewer)
library(viridisLite)
library(readxl)
```


```{r}
#We need two files for this project: 
#1) The OBA data (csv file) #Note: identical dim() to the oba .xlsx file
#2) The Oregon ecoregions data (polygon shape file)
#Reading in the files:
oba <- read.csv('../OBA_2018-2024.csv')
ecoregions_shp <- st_read("../ecoregion_shp_data/ecoregion.shp")
```


```{r}
#Visualizing the bee data. Use decimalLatitude and decimalLongitude as key
head(oba)
```


```{r}
#visualizing the ecoregions data
str(ecoregions_shp)
names(ecoregions_shp)

```

```{r}
#Visualizing the ecoregions data part 2: A map of Oregon ecoregions
eco_vect <- vect(ecoregions_shp)
r <- rast(ext(eco_vect), resolution =  1000) 
raster_output <- rasterize(ecoregions_shp, r, field = "ECO")

plot(raster_output)
```


For this project, we will be using only bee-plant interactions that occurred in coastal regions of Oregon, specifically region 1.a. Coastal Lowlands and 1.b. Coastal Uplands. However, the oba data does not have a column representing ecoregion that would allow us to subset the data. So we will join the oba data with the ecoregions data. To do this, it will be helpful to know the coordinate reference system used for the location data in the oba dataset. According to Dr. Ponisio, it is: DATUM: WGS84, unprojected lat long. EPSG code: 4326. 


```{r}
#The first step in joining the two datasets is to convert the oba data into a spatial object. We'll do so using st_as_sf()
#Note: 'sf' stands for 'simple features'

#However, the function will not accept data that has missing coordinate values, and ours does. So we will need remove any rows in the dataframe that don't have latitude and longitude values. 

sum(is.na(oba$decimalLongitude)) #there are 36
sum(is.na(oba$decimalLatitude)) #there are 36

oba_sf <- oba %>% drop_na(c(decimalLongitude, decimalLatitude))

oba_sf <- st_as_sf(oba_sf, coords = c("decimalLongitude", "decimalLatitude"), crs = 4326)

```


```{r}
#Next, we need to check if ecoregions_shp is in WGS84 (EPSG:4326) and if not, reproject it
st_crs(ecoregions_shp) == st_crs(oba_sf) #FALSE before the reprojection
oba_sf <- st_transform(oba_sf, st_crs(ecoregions_shp))
st_crs(ecoregions_shp) == st_crs(oba_sf) #TRUE after the reprojection
```


```{r}
#Now that the two sf objects have the same projection, we can join them.
#Note: The argument 'join=st_intersects' says that each point in the oba
#dataset will be assigned to the polygon(ecoregion) it lies within
oba_with_ecoregions_sf <- st_join(oba_sf, ecoregions_shp, join = st_intersects)
head(oba_with_ecoregions_sf)
```



```{r}
#Now there is an ecoregion assigned to each observation.
#However,for now, a regular dataframe will be easier to work with.
#Converting oba data back to a dataframe:
oba_with_ecoregions <- oba_with_ecoregions_sf |> st_drop_geometry()
head(oba_with_ecoregions)
```

```{r}
#test cell. 
#observing the ecoregion column
oba_with_ecoregions$ECO
#Chu it worked it worked!
```

Now that we have successfully joined the data, we can subset it to only the coastal regions 1a and 1b.

```{r}
#subsetting to coastal data only (ecoregions 1a (coastal lowlands) and 1b (coastal uplands))

coastal_oba <- subset(oba_with_ecoregions, ECO == '1a' | ECO == '1b')
coastal_oba
```





```{r}
#Start here with next steps.
#Suggestions: drop unwanted columns
```


```{r}
#Next, we need to add a column that's TRUE if the plant species is native 
#to Oregon, and FALSE if not. I'm going to populate this by hand with data from 
#oregonflora.org

#First, what are the unique plant species in our data?
plant_sp_list <- sort(unique(coastal_oba$speciesPlant))
plant_sp_list
#length(plant_sp_list) #there are 204
```


```{r}
#adding an empty column to hold the nativeplant value
coastal_oba[, 'nativePlant'] = NA

```

```{r}
#test of adding to the new column
#this works and is the syntax for populating the nativePlant column
coastal_oba$nativePlant[coastal_oba$speciesPlant == "Digitalis purpurea"] <- FALSE
coastal_oba
```

```{r}
#cell for cleaning and mutating plant names

#The 'x' designation for hypbrids came through in this dataset as 'Ã—'. I'm going to change it to 'x'.
#str_replace_all('Ã—', coastal_oba$speciesPlant, 'x') # so broken!
#Note: figure this out. But in the meantime:
coastal_oba$speciesPlant[coastal_oba$speciesPlant == 'Arctostaphylos Ã— media'] <- 'Arctostaphylos x media'
coastal_oba$speciesPlant[coastal_oba$speciesPlant == 'Erica Ã— darleyensis'] <- 'Erica x darleyensis'
coastal_oba$speciesPlant[coastal_oba$speciesPlant == 'Erysimum Ã— cheiri'] <- 'Erysimum x cheiri'


#Note: Brassica campestris and Brassica rapa are synonyms. 
#Mutating all instances of Brassica campestris to Brassica rapa
coastal_oba$speciesPlant[coastal_oba$speciesPlant == 'Brassica campestris'] <- 'Brassica rapa'

#I'm mutating Cuscata pacifica var. pacifica to simply Cuscata pacifica, since there are 
#no other Cuscata pacifica varieties in the data 
coastal_oba$speciesPlant[coastal_oba$speciesPlant == 'Cuscuta pacifica pacifica'] <- 'Cuscuta pacifica'

#I'm also mutating Cuscuta salina to Cuscuta pacifica. Oregon flora redirects the former to the latter.
coastal_oba$speciesPlant[coastal_oba$speciesPlant == 'Cuscuta salina'] <- 'Cuscuta pacifica'

#Altering the data to include the subspecies Epilobium ciliatum ciliatum in Epilobium ciliatum.
coastal_oba$speciesPlant[coastal_oba$speciesPlant == 'Epilobium ciliatum ciliatum'] <- 'Epilobium ciliatum'

plant_sp_list <- sort(unique(coastal_oba$speciesPlant))
plant_sp_list
```



```{r}
#note: some of the plant species names may need to be cleaned. if so, i'll do
#that in a cell above this one
#populating the new column for each unique plant species

#this cell: genus names beginning with 'A'

#yellow sand-verbena: native
coastal_oba$nativePlant[coastal_oba$speciesPlant == "Abronia latifolia"] <- TRUE

#common yarrow: this plant is listed as native _and_ exotic (?)
coastal_oba$nativePlant[coastal_oba$speciesPlant == "Achillea millefolium"] <- TRUE

#common onion: exotic ('known exclusively from cultivation')
coastal_oba$nativePlant[coastal_oba$speciesPlant == "Allium cepa"] <- FALSE

#nodding onion: native
coastal_oba$nativePlant[coastal_oba$speciesPlant == "Allium cernuum"] <- TRUE

#three-corner leek: exotic
coastal_oba$nativePlant[coastal_oba$speciesPlant == "Allium triquetrum"] <- FALSE

#Chinese leek: exotic
coastal_oba$nativePlant[coastal_oba$speciesPlant == "Allium tuberosum"] <- FALSE

#sugarstick: native
coastal_oba$nativePlant[coastal_oba$speciesPlant == "Allotropa virgata"] <- TRUE

#pearly everlasting: native
coastal_oba$nativePlant[coastal_oba$speciesPlant == "Anaphalis margaritacea"] <- TRUE

#Henderson's angelica: native
coastal_oba$nativePlant[coastal_oba$speciesPlant == "Angelica hendersonii"] <- TRUE

#seawatch: native
coastal_oba$nativePlant[coastal_oba$speciesPlant == "Angelica lucida"] <- TRUE

#common columbine: exotic
coastal_oba$nativePlant[coastal_oba$speciesPlant == "Aquilegia vulgaris"] <- FALSE

#Pacific madrone: native
coastal_oba$nativePlant[coastal_oba$speciesPlant == "Arbutus menziesii"] <- TRUE

# Arctostaphylos x media: native
#This is a naturally occurring hybrid between two native Oregon manzanitas:
#Arctostaphylos columbiana and Arctostaphylos uva-ursi
coastal_oba$nativePlant[coastal_oba$speciesPlant == "Arctostaphylos x media"] <- TRUE

#hairy manzanita: native
coastal_oba$nativePlant[coastal_oba$speciesPlant == "Arctostaphylos columbiana"] <- TRUE

#bearberry: native 
coastal_oba$nativePlant[coastal_oba$speciesPlant == "Arctostaphylos uva-ursi"] <- TRUE

#silverweed cinquefoil: native
#synonym: Potentilla anserina (name not in dataset)
coastal_oba$nativePlant[coastal_oba$speciesPlant == "Argentina anserina"] <- TRUE

#Pacific silverweed: native
#synonym: Potentilla anserina ssp. pacifica
coastal_oba$nativePlant[coastal_oba$speciesPlant == "Argentina pacifica"] <- TRUE

#Paris daisy: exotic
coastal_oba$nativePlant[coastal_oba$speciesPlant == "Argyranthemum frutescens"] <- FALSE

```



```{r}
#populating the new column for each unique plant species
#this cell: genus names beginning with 'B'

#chaparral broom: native
coastal_oba$nativePlant[coastal_oba$speciesPlant == "Baccharis pilularis"] <- TRUE

#yellow parentucellia: exotic
coastal_oba$nativePlant[coastal_oba$speciesPlant == "Bellardia viscosa"] <- FALSE

#English daisy: exotic
coastal_oba$nativePlant[coastal_oba$speciesPlant == "Bellis perennis"] <- FALSE

#tall Oregon grape: native
coastal_oba$nativePlant[coastal_oba$speciesPlant == "Berberis aquifolium"] <- TRUE

#Darwin's barberry: exotic
coastal_oba$nativePlant[coastal_oba$speciesPlant == "Berberis darwinii"] <- FALSE

#nodding beggars-ticks: native
coastal_oba$nativePlant[coastal_oba$speciesPlant == "Bidens cernua"] <- TRUE

#common borage: exotic
coastal_oba$nativePlant[coastal_oba$speciesPlant == "Borago officinalis"] <- FALSE

#field mustard: exotic
#Note: Brassica campestris and Brassica rapa are synonyms. 
#I mutated the data set: changed all instances of Brassica campestris to Brassica rapa
coastal_oba$nativePlant[coastal_oba$speciesPlant == "Brassica rapa"] <- FALSE

```



```{r}
#populating the new column for each unique plant species
#this cell: genus names beginning with 'C'

#American searocket: exotic
coastal_oba$nativePlant[coastal_oba$speciesPlant == "Cakile edentula"] <- FALSE

#European searocket: exotic
coastal_oba$nativePlant[coastal_oba$speciesPlant == "Cakile maritima"] <- FALSE

#calendula: exotic
coastal_oba$nativePlant[coastal_oba$speciesPlant == "Calendula officinalis"] <- FALSE

#Scotch heather: exotic
coastal_oba$nativePlant[coastal_oba$speciesPlant == "Calluna vulgaris"] <- FALSE

#hedge bindweed: exotic
coastal_oba$nativePlant[coastal_oba$speciesPlant == "Calystegia sepium"] <- FALSE

#coast morning-glory: native
coastal_oba$nativePlant[coastal_oba$speciesPlant == "Calystegia soldanella"] <- TRUE

#blue blossom: native
coastal_oba$nativePlant[coastal_oba$speciesPlant == "Ceanothus thyrsiflorus"] <- TRUE

#brown knapweed: exotic
coastal_oba$nativePlant[coastal_oba$speciesPlant == "Centaurea jacea"] <- FALSE

#mountain cornflower: exotic
coastal_oba$nativePlant[coastal_oba$speciesPlant == "Centaurea montana"] <- FALSE

#sticky mouse-ear chickweed: exotic
coastal_oba$nativePlant[coastal_oba$speciesPlant == "Cerastium glomeratum"] <- FALSE

#great willowherb: native
coastal_oba$nativePlant[coastal_oba$speciesPlant == "Chamaenerion angustifolium"] <- TRUE

#chickory: exotic
coastal_oba$nativePlant[coastal_oba$speciesPlant == "Cichorium intybus"] <- FALSE

#western water hemlock: native
coastal_oba$nativePlant[coastal_oba$speciesPlant == "Cicuta douglasii"] <- TRUE

#Canada thistle: exotic
coastal_oba$nativePlant[coastal_oba$speciesPlant == "Cirsium arvense"] <- FALSE

#edible thistle: native
coastal_oba$nativePlant[coastal_oba$speciesPlant == "Cirsium edule"] <- TRUE

#bull thistle: exotic
coastal_oba$nativePlant[coastal_oba$speciesPlant == "Cirsium vulgare"] <- FALSE

#farewell-to-spring: native
coastal_oba$nativePlant[coastal_oba$speciesPlant == "Clarkia amoena"] <- TRUE

#diamond clarkia: native
coastal_oba$nativePlant[coastal_oba$speciesPlant == "Clarkia rhomboidea"] <- TRUE

#candyflower: native
coastal_oba$nativePlant[coastal_oba$speciesPlant == "Claytonia sibirica"] <- TRUE

#large flowered blue eyed Mary: native
coastal_oba$nativePlant[coastal_oba$speciesPlant == "Collinsia grandiflora"] <- TRUE

#small flowered blue eyed Mary: native
coastal_oba$nativePlant[coastal_oba$speciesPlant == "Collinsia parviflora"] <- TRUE

#Pacific hemlock parsley: native
##synonym: Conioselinum pacifica (name not in dataset)
coastal_oba$nativePlant[coastal_oba$speciesPlant == "Conioselinum gmelinii"] <- TRUE

#cosmos: exotic
coastal_oba$nativePlant[coastal_oba$speciesPlant == "Cosmos bipinnatus"] <- FALSE

#late cotoneaster or milkflower cotoneaster: exotic
coastal_oba$nativePlant[coastal_oba$speciesPlant == "Cotoneaster coriaceus"] <- FALSE

#English hawthorn: exotic
coastal_oba$nativePlant[coastal_oba$speciesPlant == "Crataegus monogyna"] <- FALSE

#smooth hawksbeard: exotic
coastal_oba$nativePlant[coastal_oba$speciesPlant == "Crepis capillaris"] <- FALSE

#annual hawksbeard: exotic
coastal_oba$nativePlant[coastal_oba$speciesPlant == "Crepis tectorum"] <- FALSE

#Pacific salt marsh dodder: native
#Note: I altered the data to change Cuscuta pacifica pacifica and 
#Cuscuta salina to Cuscuta pacifica. They're synonymous in Oregon.
coastal_oba$nativePlant[coastal_oba$speciesPlant == "Cuscuta pacifica"] <- TRUE

#Scots broom: exotic
coastal_oba$nativePlant[coastal_oba$speciesPlant == "Cytisus scoparius"] <- FALSE

```


```{r}
plant_sp_list

```


```{r}
#populating the new column for each unique plant species
#this cell: genus names beginning with 'D' and 'E'

#wild carrot (Queen Anne's lace): exotic
coastal_oba$nativePlant[coastal_oba$speciesPlant == "Daucus carota"] <- FALSE

#foxglove: exotic
coastal_oba$nativePlant[coastal_oba$speciesPlant == "Digitalis purpurea"] <- FALSE

#sticky cinquefoil: native
coastal_oba$nativePlant[coastal_oba$speciesPlant == "Drymocallis glandulosa"] <- TRUE

#fringed willowherb: native
#Note: I altered the data to include the subspecies Epilobium ciliatum ciliatum in Epilobium ciliatum.
coastal_oba$nativePlant[coastal_oba$speciesPlant == "Epilobium ciliatum"] <- TRUE

#spring heath: exotic
coastal_oba$nativePlant[coastal_oba$speciesPlant == "Erica carnea"] <- FALSE

#bell heather: exotic
coastal_oba$nativePlant[coastal_oba$speciesPlant == "Erica cinerea"] <- FALSE

#Darley Dale heath: exotic
#This is a hybrid between E. carnea and E. erigena
coastal_oba$nativePlant[coastal_oba$speciesPlant == "Erica x darleyensis"] <- FALSE

#Canadian fleabane: native
coastal_oba$nativePlant[coastal_oba$speciesPlant == "Erigeron canadensis"] <- TRUE

#seaside fleabane: native 
coastal_oba$nativePlant[coastal_oba$speciesPlant == "Erigeron glaucus"] <- TRUE

#seaside buckwheat: native
coastal_oba$nativePlant[coastal_oba$speciesPlant == "Eriogonum latifolium"] <- TRUE

#wallflower: exotic
coastal_oba$nativePlant[coastal_oba$speciesPlant == "Erysimum x cheiri"] <- FALSE

#large monkeyflower: native
coastal_oba$nativePlant[coastal_oba$speciesPlant == "Erythranthe grandis"] <- TRUE

#redclaws: exotic
coastal_oba$nativePlant[coastal_oba$speciesPlant == "Escallonia rubra"] <- FALSE

#California poppy: native
coastal_oba$nativePlant[coastal_oba$speciesPlant == "Eschscholzia californica"] <- TRUE

#ulmo: exotic
coastal_oba$nativePlant[coastal_oba$speciesPlant == "Eucryphia cordifolia"] <- FALSE

#wood spurge: exotic
coastal_oba$nativePlant[coastal_oba$speciesPlant == "Euphorbia amygdaloides"] <- FALSE

```


```{r}
#populating the new column for each unique plant species
#this cell: genus names beginning with 'F'
```



